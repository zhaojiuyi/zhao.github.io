<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>爬虫笔记</title>
      <link href="/2022/05/21/spider-notebook/"/>
      <url>/2022/05/21/spider-notebook/</url>
      
        <content type="html"><![CDATA[<p>实验中所用到的网页均来自开课吧</p><h3 id="了解爬虫基本原理"><a href="#了解爬虫基本原理" class="headerlink" title="了解爬虫基本原理"></a>了解爬虫基本原理</h3><p>所谓爬虫，就是一种用于爬取网络资源或数据的程序，它通过一定的规则，模拟浏览器向服务器发送请求的过程，并接收响应数据，从而达到获取资源的目的。原理上，浏览器（或客户端）等完成的事，爬虫也能完成。</p><p>在学习爬虫之前，我们应该先认识一下http报文，了解什么是请求头，请求体，响应头和响应体。</p><p>我们得知道，爬虫能爬取的应该是我们能看到，且已知存在的资源。所以首先我们得知道自己要爬取的资源地址，通过向该地址发起网络请求，获得响应体，从而达到获取数据的目的。</p><h5 id="爬虫的四个基本步骤"><a href="#爬虫的四个基本步骤" class="headerlink" title="爬虫的四个基本步骤"></a>爬虫的四个基本步骤</h5><p>获取数据 —&gt; 解析数据 —&gt; 筛选数据 —&gt; 储存数据</p><p>下载相关模块：</p><ul><li><p>requests（用于获取数据）</p></li><li><p>BeautifulSoup（解析和提取数据）</p></li></ul><pre class="language-python" data-language="python"><code class="language-python">pip instal requestspip install bs4</code></pre><h3 id="我的第一只爬虫"><a href="#我的第一只爬虫" class="headerlink" title="我的第一只爬虫"></a>我的第一只爬虫</h3><h4 id="使用requests进行网页数据爬取"><a href="#使用requests进行网页数据爬取" class="headerlink" title="使用requests进行网页数据爬取"></a>使用requests进行网页数据爬取</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">## 导入模块</span><span class="token keyword">import</span> requests res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.zhaojiuyi.top/"</span><span class="token punctuation">)</span><span class="token comment"># print(res) #因为这里爬取的是我的博客网站，所以会打印很多html标签</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 使用requests.get方法得到了一个Response（响应）对象</span><span class="token comment">## &lt;class 'requests.models.Response'></span></code></pre><h4 id="response常用的四种属性："><a href="#response常用的四种属性：" class="headerlink" title="response常用的四种属性："></a>response常用的四种属性：</h4><ul><li><p>1，reponse.status    code 响应状态码，检查请求是否成功</p></li><li><p>2，reponse.content    reponse对象的二进制数据</p></li><li><p>3，reponse.text   reponse对象的字符串数据</p></li><li><p>4，reponse.encoding    reponse对象的编码（requests会自己去判断返回数据的编码类型。当判断出错导致乱码的时候，我们就需要自己去指定编码类型，也就是 response.encoding，我们指定的编码类型必须和原数据的编码类型一致）</p></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'响应状态码为：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>  <span class="token comment"># 如果响应状态码返回200说明请求成功</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment"># 直接以字符串的形式打印response对象内容</span></code></pre><p>除了爬取html网页，我们还可以爬取图片，视频等。</p><h3 id="Robots-协议"><a href="#Robots-协议" class="headerlink" title="Robots 协议"></a>Robots 协议</h3><p>对于服务器来说，它是不允许恶意爬虫和高频次请求的爬虫，因为这可能会导致服务器崩溃。不过在一般情况下，服务器都是允许搜索引擎的爬虫在规则允许的情况下对网站进行爬取，收录。</p><p>这些规则，就写在每个网站的 Robots 协议中。 查看 Robots 协议的话，只需要在域名后加入 &#x2F;robots.txt 就可以查看了。</p><p>让我们看看爱奇艺的Robots协议<a href="https://www.iqiyi.com/robots.txt">https://www.iqiyi.com/robots.txt</a></p><p><img src="/2022/05/21/spider-notebook/image-20220522121032208.png" alt="image-20220522121032208"></p><p>Allow和Disallow，Allow代表可以被访问，Disallow代表禁止被访问。</p><h3 id="BeautifulSoup数据解析"><a href="#BeautifulSoup数据解析" class="headerlink" title="BeautifulSoup数据解析"></a>BeautifulSoup数据解析</h3><p>beautifulsoup只能只能只能对 —— 字符串类型 —— 的值或者变量进行解析</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoupres <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/canteen/index.html'</span><span class="token punctuation">)</span>html <span class="token operator">=</span> res<span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打印res.text对象的类型，发现为str</span><span class="token comment">## beautifulsoup只能只能只能对  字符串类型  的值或者变量进行解析</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> <span class="token comment">##对res.text进行解析，解析方式为 html.parser</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>soup<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#查看soup类型，发现解析后的对象为BeautifulSoup对象</span><span class="token comment"># print(soup)</span><span class="token comment">## &lt;class 'str'></span><span class="token comment">## &lt;class 'bs4.BeautifulSoup'></span></code></pre><h4 id="使用BeautifulSoup提取数据"><a href="#使用BeautifulSoup提取数据" class="headerlink" title="使用BeautifulSoup提取数据"></a>使用BeautifulSoup提取数据</h4><p>find()与find_all()，以及Tag对象。</p><p>find()与find_all()是BeautifulSoup对象的两个方法，它们可以匹配HTML的标签和属性，把BeautifulSoup对象里符合要求的数据都提取出来。<br>find()只提取首个满足要求的数据，而find_all()提取出的是所有满足要求的数据。</p><p>find(标签，属性) example: find(div)   find(div,class_&#x3D;’show_list_item’)</p><pre class="language-python" data-language="python"><code class="language-python">url <span class="token operator">=</span> <span class="token string">'https://localprod.pandateacher.com/python-manuscript/crawler-html/spder-men0.0.html'</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get <span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'状态码：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span>item1 <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> <span class="token comment">#使用find()方法提取首个&lt;div>元素，并放到变量item1里。</span>item2 <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'打印使用find()方法得到的类型：</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">type</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token comment">#打印item1的数据类型 ,发现是tag类的对象</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'打印使用find_all()方法得到的类型：</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">type</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token comment">#打印item2的数据类型 ,发现是ResultSet类的对象，相当于将tag对象以列表的方式存起来</span><span class="token keyword">print</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span> <span class="token comment">#打印item1</span><span class="token keyword">print</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span> <span class="token comment">#打印item2</span><span class="token comment">#状态码：200</span><span class="token comment">#打印使用find()方法得到的类型：&lt;class 'bs4.element.Tag'></span><span class="token comment">#打印使用find_all()方法得到的类型：&lt;class 'bs4.element.ResultSet'></span><span class="token comment">#&lt;div>大家好，我是一个块&lt;/div></span><span class="token comment">#[&lt;div>大家好，我是一个块&lt;/div>, &lt;div>我也是一个块&lt;/div>, &lt;div>我还是一个块&lt;/div>]</span></code></pre><p>要考虑的就是，要用什么参数去查找和定位，标签，还是属性。此时，可以用到开发者工具的搜索功能</p><p>点击右键-显示网页源代码，在这个页面里去搜索会更加准确</p><pre class="language-python" data-language="python"><code class="language-python">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/canteen/index.html'</span><span class="token punctuation">)</span>html <span class="token operator">=</span> res<span class="token punctuation">.</span>textsoup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> items <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'show-list-item'</span><span class="token punctuation">)</span> <span class="token comment"># 通过匹配标签和属性提取我们想要的数据</span><span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token comment"># 打印items</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#打印items的数据类型</span></code></pre><pre class="language-python" data-language="python"><code class="language-python">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/canteen/index.html'</span><span class="token punctuation">)</span>html <span class="token operator">=</span> res<span class="token punctuation">.</span>textsoup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> items <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'show-list-item'</span><span class="token punctuation">)</span> <span class="token comment"># print(items)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># &lt;class 'bs4.element.ResultSet'></span><span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'item对象类型：</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">type</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token comment">#     print(item) # 打印item</span><span class="token comment"># item对象类型：&lt;class 'bs4.element.Tag'></span><span class="token comment"># item对象类型：&lt;class 'bs4.element.Tag'></span><span class="token comment"># item对象类型：&lt;class 'bs4.element.Tag'></span></code></pre><h4 id="Tag对象的三种常用属性与方法"><a href="#Tag对象的三种常用属性与方法" class="headerlink" title="Tag对象的三种常用属性与方法"></a>Tag对象的三种常用属性与方法</h4><ul><li>Tag.find() 与 Tag.find_all()———-Tag对象可以使用find()与find_all()来继续检索，提取Tag中的Tag</li><li>Tag.text——————————提取Tag中的文字</li><li>Tag[‘属性名’]————————–输入参数：属性名，可以提取Tag中这个属性的值</li></ul><pre class="language-python" data-language="python"><code class="language-python">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/canteen/index.html'</span><span class="token punctuation">)</span>html <span class="token operator">=</span> res<span class="token punctuation">.</span>textsoup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span> items <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'show-list-item'</span><span class="token punctuation">)</span><span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>    title <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-title'</span><span class="token punctuation">)</span> <span class="token comment"># 在列表中的每个元素里，匹配属性class_='title'提取出数据</span>    material <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-material'</span><span class="token punctuation">)</span> <span class="token comment">#在列表中的每个元素里，匹配属性class_='desc-material'提取出数据</span>    step <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-step'</span><span class="token punctuation">)</span> <span class="token comment">#在列表中的每个元素里，匹配属性class_='desc-step'提取出数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>material<span class="token punctuation">,</span>step<span class="token punctuation">)</span> <span class="token comment"># 打印提取出的数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>material<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 打印提取出的数据类型</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>    title <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-title'</span><span class="token punctuation">)</span> <span class="token comment"># 在列表中的每个元素里，匹配属性class_='title'提取出数据</span>    material <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-material'</span><span class="token punctuation">)</span> <span class="token comment">#在列表中的每个元素里，匹配属性class_='desc-material'提取出数据</span>    step <span class="token operator">=</span> item<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'desc-step'</span><span class="token punctuation">)</span> <span class="token comment">#在列表中的每个元素里，匹配属性class_='desc-step'提取出数据</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span>material<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">,</span>step<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h3 id="借助更多的工具-Network，XHR，json"><a href="#借助更多的工具-Network，XHR，json" class="headerlink" title="借助更多的工具 Network，XHR，json"></a>借助更多的工具 Network，XHR，json</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token comment"># 引用requests库</span>res_music <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://c.y.qq.com/soso/fcgi-bin/client_search_cp?ct=24&amp;qqmusic_ver=1298&amp;new_json=1&amp;remoteplace=txt.yqq.song&amp;searchid=65805191174562925&amp;t=0&amp;aggr=1&amp;cr=1&amp;catZhida=1&amp;lossless=0&amp;flag_qc=0&amp;p=1&amp;n=10&amp;w=%E4%BA%94%E6%9C%88%E5%A4%A9&amp;g_tk=5381&amp;loginUin=0&amp;hostUin=0&amp;format=json&amp;inCharset=utf8&amp;outCharset=utf-8&amp;notice=0&amp;platform=yqq.json&amp;needNewCode=0'</span><span class="token punctuation">)</span><span class="token comment"># 调用get方法，下载这个字典</span>json_music <span class="token operator">=</span> res_music<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 使用json()方法，将response对象，转为列表/字典</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>json_music<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 打印json_music的数据类型 &lt;class 'dict'></span>musics <span class="token operator">=</span> json_music<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'song'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token keyword">for</span> music <span class="token keyword">in</span> musics<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsres_music <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://c.y.qq.com/soso/fcgi-bin/client_search_cp?ct=24&amp;qqmusic_ver=1298&amp;new_json=1&amp;remoteplace=txt.yqq.song&amp;searchid=65805191174562925&amp;t=0&amp;aggr=1&amp;cr=1&amp;catZhida=1&amp;lossless=0&amp;flag_qc=0&amp;p=1&amp;n=10&amp;w=%E4%BA%94%E6%9C%88%E5%A4%A9&amp;g_tk=5381&amp;loginUin=0&amp;hostUin=0&amp;format=json&amp;inCharset=utf8&amp;outCharset=utf-8&amp;notice=0&amp;platform=yqq.json&amp;needNewCode=0'</span><span class="token punctuation">)</span>json_music <span class="token operator">=</span> res_music<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>list_music <span class="token operator">=</span> json_music<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'song'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token comment"># 一层一层地取字典，获取歌单列表</span><span class="token keyword">for</span> music <span class="token keyword">in</span> list_music<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'歌名：'</span><span class="token operator">+</span>music<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'所属专辑：'</span><span class="token operator">+</span>music<span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'播放时长：'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'interval'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'秒'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'播放链接：https://y.qq.com/n/yqq/song/'</span><span class="token operator">+</span>music<span class="token punctuation">[</span><span class="token string">'mid'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.html\n\n'</span><span class="token punctuation">)</span></code></pre><h4 id="自定义请求头"><a href="#自定义请求头" class="headerlink" title="自定义请求头"></a>自定义请求头</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsheaders<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36'</span><span class="token punctuation">&#125;</span><span class="token comment">##自定义请求头</span>url <span class="token operator">=</span> <span class="token string">'https://c.y.qq.com/soso/fcgi-bin/client_search_cp'</span><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    param <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token comment">#利用param实现参数变化</span>        <span class="token string">'ct'</span><span class="token punctuation">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span>        <span class="token string">'qqmusic_ver'</span><span class="token punctuation">:</span> <span class="token string">'1298'</span><span class="token punctuation">,</span>        <span class="token string">'new_json'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'remoteplace'</span><span class="token punctuation">:</span> <span class="token string">'sizer.yqq.song_next'</span><span class="token punctuation">,</span>        <span class="token string">'t'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'aggr'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'cr'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'catZhida'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'lossless'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'flag_qc'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'p'</span><span class="token punctuation">:</span> x<span class="token punctuation">,</span>  <span class="token comment">#设置页数</span>        <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token comment">##设置每一页的歌曲数量</span>        <span class="token string">'w'</span><span class="token punctuation">:</span> <span class="token string">'五月天'</span><span class="token punctuation">,</span>        <span class="token string">'g_tk'</span><span class="token punctuation">:</span> <span class="token string">'5381'</span><span class="token punctuation">,</span>        <span class="token string">'loginUin'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'hostUin'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>        <span class="token string">'inCharset'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>        <span class="token string">'outCharset'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>        <span class="token string">'notice'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'platform'</span><span class="token punctuation">:</span> <span class="token string">'yqq.json'</span><span class="token punctuation">,</span>        <span class="token string">'needNewCode'</span><span class="token punctuation">:</span> <span class="token string">'0'</span>    <span class="token punctuation">&#125;</span>    res_songs<span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>param<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    json_songs <span class="token operator">=</span> res_songs<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    list_songs <span class="token operator">=</span> json_songs<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'song'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> song <span class="token keyword">in</span> list_songs<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>song<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">#输出的时候标记歌曲所在的页码</span></code></pre><pre class="language-python" data-language="python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'origin'</span><span class="token punctuation">:</span><span class="token string">'https://y.qq.com'</span><span class="token punctuation">,</span>    <span class="token comment"># 请求来源</span>    <span class="token string">'referer'</span><span class="token punctuation">:</span><span class="token string">'https://y.qq.com/n/yqq/song/004Z8Ihr0JIu5s.html'</span><span class="token punctuation">,</span>    <span class="token comment"># 请求来源</span>    <span class="token string">'user-agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36'</span><span class="token punctuation">,</span>    <span class="token comment"># 标记了请求从什么设备，什么浏览器上发出</span>    <span class="token punctuation">&#125;</span><span class="token comment"># 伪装请求头</span>res_songs<span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">## 根据歌手名字进行查找歌曲</span><span class="token keyword">import</span> requests<span class="token comment">#调用requests模块</span>choice <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入歌手名字'</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">'https://c.y.qq.com/soso/fcgi-bin/client_search_cp'</span><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>params <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'ct'</span><span class="token punctuation">:</span><span class="token string">'24'</span><span class="token punctuation">,</span><span class="token string">'qqmusic_ver'</span><span class="token punctuation">:</span> <span class="token string">'1298'</span><span class="token punctuation">,</span><span class="token string">'new_json'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'remoteplace'</span><span class="token punctuation">:</span><span class="token string">'txt.yqq.song'</span><span class="token punctuation">,</span><span class="token string">'searchid'</span><span class="token punctuation">:</span><span class="token string">'70717568573156220'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'aggr'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'cr'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'catZhida'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'lossless'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'flag_qc'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'p'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">:</span><span class="token string">'20'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">:</span>choice<span class="token punctuation">,</span><span class="token string">'g_tk'</span><span class="token punctuation">:</span><span class="token string">'714057807'</span><span class="token punctuation">,</span><span class="token string">'loginUin'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'hostUin'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'format'</span><span class="token punctuation">:</span><span class="token string">'json'</span><span class="token punctuation">,</span><span class="token string">'inCharset'</span><span class="token punctuation">:</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token string">'outCharset'</span><span class="token punctuation">:</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span><span class="token string">'notice'</span><span class="token punctuation">:</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'platform'</span><span class="token punctuation">:</span><span class="token string">'yqq.json'</span><span class="token punctuation">,</span><span class="token string">'needNewCode'</span><span class="token punctuation">:</span><span class="token string">'0'</span> <span class="token punctuation">&#125;</span><span class="token comment"># 将参数封装为字典</span>res_music <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>params<span class="token punctuation">)</span><span class="token comment"># 调用get方法，下载这个列表</span>json_music <span class="token operator">=</span> res_music<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 使用json()方法，将response对象，转为列表/字典</span>list_music <span class="token operator">=</span> json_music<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'song'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token comment"># 一层一层地取字典，获取歌单列表</span><span class="token keyword">for</span> music <span class="token keyword">in</span> list_music<span class="token punctuation">:</span><span class="token comment"># list_music是一个列表，music是它里面的元素</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 以name为键，查找歌曲名</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'所属专辑：'</span><span class="token operator">+</span>music<span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 查找专辑名</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'播放时长：'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'interval'</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'分钟'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'interval'</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'秒'</span><span class="token punctuation">)</span><span class="token comment"># 查找播放时长</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'播放链接：https://y.qq.com/n/yqq/song/'</span><span class="token operator">+</span>music<span class="token punctuation">[</span><span class="token string">'mid'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.html\n\n'</span><span class="token punctuation">)</span><span class="token comment"># 查找播放链接</span></code></pre><h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p>csv:import csv ; Excel:pip install openpyxl</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> openpyxl<span class="token comment"># 存</span><span class="token comment"># 引用openpyxl</span>wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 利用openpyxl.Workbook()函数创建新的workbook（工作薄）对象，就是创建新的空的Excel文件。</span>sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>active<span class="token comment"># wb.active就是获取这个工作薄的活动表，通常就是第一个工作簿，也就是我们在上面的图片中看到的sheet1。</span>sheet<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'示例'</span><span class="token comment"># 可以用.title给工作表重命名。现在第一个工作表的名称就会由原来默认的“sheet1”改为"kaikeba"。</span>sheet<span class="token punctuation">[</span><span class="token string">'A1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token comment"># 向单个单元格写入数据</span>score1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'math'</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span>sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score1<span class="token punctuation">)</span><span class="token comment"># 写入整行的数据，变量类型是一个列表</span>wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'score.xlsx'</span><span class="token punctuation">)</span><span class="token comment"># 保存修改的Excel</span>wb<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 关闭Excel</span><span class="token comment"># 取</span>wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span><span class="token string">'score.xlsx'</span><span class="token punctuation">)</span><span class="token comment"># 打开的指定的工作簿</span>sheet <span class="token operator">=</span> wb<span class="token punctuation">[</span><span class="token string">'示例'</span><span class="token punctuation">]</span><span class="token comment"># 指定读取的工作表的名称</span>A1_value <span class="token operator">=</span> sheet<span class="token punctuation">[</span><span class="token string">'A1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token keyword">print</span><span class="token punctuation">(</span>A1_value<span class="token punctuation">)</span><span class="token comment"># 获取</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> openpyxlurl <span class="token operator">=</span> <span class="token string">'https://c.y.qq.com/soso/fcgi-bin/client_search_cp'</span>wb<span class="token operator">=</span>openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#创建工作薄</span>sheet<span class="token operator">=</span>wb<span class="token punctuation">.</span>active<span class="token comment">#获取工作薄的活动表</span>sheet<span class="token punctuation">.</span>title<span class="token operator">=</span><span class="token string">'songs_mayday'</span><span class="token comment">#工作表重命名</span>column_name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'歌曲名'</span><span class="token punctuation">,</span><span class="token string">'所属专辑'</span><span class="token punctuation">,</span><span class="token string">'播放时长'</span><span class="token punctuation">,</span><span class="token string">'播放链接'</span><span class="token punctuation">]</span>sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'ct'</span><span class="token punctuation">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span>        <span class="token string">'qqmusic_ver'</span><span class="token punctuation">:</span> <span class="token string">'1298'</span><span class="token punctuation">,</span>        <span class="token string">'new_json'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'remoteplace'</span><span class="token punctuation">:</span> <span class="token string">'sizer.yqq.song_next'</span><span class="token punctuation">,</span>        <span class="token string">'searchid'</span><span class="token punctuation">:</span> <span class="token string">'64405487069162918'</span><span class="token punctuation">,</span>        <span class="token string">'t'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'aggr'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'cr'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'catZhida'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>        <span class="token string">'lossless'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'flag_qc'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'p'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span>        <span class="token string">'w'</span><span class="token punctuation">:</span> <span class="token string">'五月天'</span><span class="token punctuation">,</span>        <span class="token string">'g_tk'</span><span class="token punctuation">:</span> <span class="token string">'5381'</span><span class="token punctuation">,</span>        <span class="token string">'loginUin'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'hostUin'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'format'</span><span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>        <span class="token string">'inCharset'</span><span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>        <span class="token string">'outCharset'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>        <span class="token string">'notice'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>        <span class="token string">'platform'</span><span class="token punctuation">:</span> <span class="token string">'yqq.json'</span><span class="token punctuation">,</span>        <span class="token string">'needNewCode'</span><span class="token punctuation">:</span> <span class="token string">'0'</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># 将参数封装为字典</span>    res_music <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>    <span class="token comment"># 调用get方法，下载这个列表</span>    json_music <span class="token operator">=</span> res_music<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 使用json()方法，将response对象，转为列表/字典</span>    list_music <span class="token operator">=</span> json_music<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'song'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>    <span class="token comment"># 一层一层地取字典，获取歌单列表</span>    <span class="token keyword">for</span> music <span class="token keyword">in</span> list_music<span class="token punctuation">:</span>        name <span class="token operator">=</span> music<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>        <span class="token comment"># 以name为键，查找歌曲名，把歌曲名赋值给name</span>        album <span class="token operator">=</span> music<span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>        <span class="token comment"># 查找专辑名，把专辑名赋给album</span>        time <span class="token operator">=</span> music<span class="token punctuation">[</span><span class="token string">'interval'</span><span class="token punctuation">]</span>        <span class="token comment"># 查找播放时长，把时长赋值给time</span>        link <span class="token operator">=</span> <span class="token string">'https://y.qq.com/n/yqq/song/'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>music<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'media_mid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.html\n\n'</span>        <span class="token comment"># 查找播放链接，把链接赋值给link</span>        sheet<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">,</span> album<span class="token punctuation">,</span> time<span class="token punctuation">,</span> link<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment"># 把name、album、time和link写成列表，用append函数多行写入Excel</span>wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'mayday.xlsx'</span><span class="token punctuation">)</span>wb<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#最后保存并关闭这个Excel文件</span><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pdsongs <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'mayday.xlsx'</span><span class="token punctuation">)</span>songs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment">#切片打印歌单</span></code></pre><h3 id="分页爬取"><a href="#分页爬取" class="headerlink" title="分页爬取"></a>分页爬取</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> csv<span class="token comment"># 准备头文件</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36'</span><span class="token punctuation">&#125;</span><span class="token comment"># 新建csv文件并打开文件</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'articles.csv'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token comment"># 写入表头</span>writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'标题'</span><span class="token punctuation">,</span> <span class="token string">'链接'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 设置爬取链接</span>url <span class="token operator">=</span> <span class="token string">'https://i.news.qq.com/trpc.qqnews_web.kv_srv.kv_srv_http_proxy/list'</span><span class="token comment"># 设置 offset 的起始值为 0</span>offset <span class="token operator">=</span> <span class="token number">0</span><span class="token comment"># 循环三页</span><span class="token keyword">while</span> offset <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>    <span class="token comment"># 封装参数</span>    params <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'sub_srv_id'</span><span class="token punctuation">:</span> <span class="token string">'antip'</span><span class="token punctuation">,</span> <span class="token string">'srv_id'</span><span class="token punctuation">:</span> <span class="token string">'pc'</span><span class="token punctuation">,</span> <span class="token string">'offset'</span><span class="token punctuation">:</span> offset<span class="token punctuation">,</span> <span class="token string">'limit'</span><span class="token punctuation">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token string">'strategy'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>              <span class="token string">'ext'</span><span class="token punctuation">:</span> <span class="token string">'&#123;"pool":["high","top"],"is_filter":10,"check_type":true&#125;'</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 发送请求，并把响应内容赋值给变量 res</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    <span class="token comment"># 使用 json 方法将响应结果读成字典</span>    articles <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 取出 data 对应的值</span>    data <span class="token operator">=</span> articles<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span>    <span class="token comment"># print(data)</span>    <span class="token comment"># 遍历 data 内容</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token comment"># 判断这行内容是不是文章</span>        <span class="token keyword">if</span> i<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># print(i)</span>            <span class="token comment"># 取出这行内容，放到列表里</span>            row <span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>            <span class="token comment"># 写入这行内容</span>            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>    <span class="token comment"># 换页</span>    offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token number">20</span><span class="token comment"># 关闭文件</span><span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="爬取娱乐新闻"><a href="#爬取娱乐新闻" class="headerlink" title="爬取娱乐新闻"></a>爬取娱乐新闻</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">## 爬取娱乐新闻</span>url <span class="token operator">=</span> <span class="token string">'https://i.news.qq.com/trpc.qqnews_web.kv_srv.kv_srv_http_proxy/list?sub_srv_id=ent&amp;srv_id=pc&amp;offset=0&amp;limit=20&amp;strategy=1&amp;ext=&#123;%22pool%22:[%22top%22],%22is_filter%22:10,%22check_type%22:true&#125;'</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>bes <span class="token operator">=</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>bes<span class="token punctuation">)</span><span class="token punctuation">)</span>data <span class="token operator">=</span> bes<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>    name <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>    url_html <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">': '</span><span class="token operator">+</span>url_html<span class="token punctuation">)</span></code></pre><h3 id="爬虫进阶-cookie"><a href="#爬虫进阶-cookie" class="headerlink" title="爬虫进阶 cookie"></a>爬虫进阶 cookie</h3><p>利用cookie登录kaikeba 实验网址：<a href="https://xiaoke.kaikeba.com/example/wordpress/wp-login.php">https://xiaoke.kaikeba.com/example/wordpress/wp-login.php</a> 用户名：kaikeba 密码：kaikeba888 ，提交评论</p><pre class="language-python" data-language="python"><code class="language-python">url <span class="token operator">=</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/wp-login.php'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span><span class="token punctuation">&#125;</span><span class="token comment">## 自定义请求头，防止反爬虫</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'log'</span><span class="token punctuation">:</span> <span class="token string">'kaikeba'</span><span class="token punctuation">,</span>    <span class="token string">'pwd'</span><span class="token punctuation">:</span> <span class="token string">'kaikeba888'</span><span class="token punctuation">,</span>    <span class="token string">'rememberme'</span><span class="token punctuation">:</span> <span class="token string">'forever'</span><span class="token punctuation">,</span>    <span class="token string">'wp-submit'</span><span class="token punctuation">:</span> <span class="token string">'登录'</span><span class="token punctuation">,</span>    <span class="token string">'redirect_to'</span><span class="token punctuation">:</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/2019/10/17/%e5%bc%80%e8%af%be%e5%90%a7%e6%97%a0%e6%95%8c%e5%a5%bd%e5%90%83%e7%9a%84%e9%a3%9f%e5%a0%82%e4%b8%80%e5%91%a8%e8%8f%9c%e8%b0%b1/'</span><span class="token punctuation">,</span>    <span class="token string">'testcookie'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">&#125;</span><span class="token comment">## 自定义登录的参数（form data,参数的值自定义），封装成字典</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status_code<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 打印状态码</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"登录成功!!!!"</span><span class="token punctuation">)</span>    cookie <span class="token operator">=</span> res<span class="token punctuation">.</span>cookies    <span class="token keyword">print</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>  <span class="token comment"># 打印cookie</span>url1 <span class="token operator">=</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/wp-comments-post.php'</span>data1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'comment'</span><span class="token punctuation">:</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入评论："</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'submit'</span><span class="token punctuation">:</span> <span class="token string">'发表评论'</span><span class="token punctuation">,</span>    <span class="token string">'comment_post_ID'</span><span class="token punctuation">:</span> <span class="token string">'35'</span><span class="token punctuation">,</span>    <span class="token string">'comment_parent'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">&#125;</span>res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url1<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data1<span class="token punctuation">,</span>cookies<span class="token operator">=</span>cookie<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre><h3 id="session-会话"><a href="#session-会话" class="headerlink" title="session(会话)"></a>session(会话)</h3><p>所谓的会话，可以理解成我们用浏览器上网，到关闭浏览器的这一过程。session是会话过程中，服务器用来记录特定用户会话的信息。</p><ul><li>session和cookie的关系还非常密切——cookie中存储着session的编码信息，session中又存储了cookie的信息。</li><li>当浏览器第一次访问购物网页时，服务器会返回set cookie的字段给浏览器，而浏览器会把cookie保存到本地。</li><li>等浏览器第二次访问这个购物网页时，就会带着cookie去请求，而因为cookie里带有会话的编码信息，服务器立马就能辨认出这个用户，同时返回和这个用户相关的特定编码的session。</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestssession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#用requests.session()创建session对象，相当于创建了一个特定的会话，帮我们自动保持了cookie。</span>url_login <span class="token operator">=</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/wp-login.php'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36'</span><span class="token punctuation">&#125;</span>data_login <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'log'</span><span class="token punctuation">:</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入账号：'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#用input函数填写账号和密码，这样代码更优雅，而不是直接把账号密码填上去。</span>    <span class="token string">'pwd'</span><span class="token punctuation">:</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入密码：'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'wp-submit'</span><span class="token punctuation">:</span><span class="token string">'登录'</span><span class="token punctuation">,</span>    <span class="token string">'redirect_to'</span><span class="token punctuation">:</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/2019/10/17/%e5%bc%80%e8%af%be%e5%90%a7%e6%97%a0%e6%95%8c%e5%a5%bd%e5%90%83%e7%9a%84%e9%a3%9f%e5%a0%82%e4%b8%80%e5%91%a8%e8%8f%9c%e8%b0%b1/'</span><span class="token punctuation">,</span>    <span class="token string">'testcookie'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">&#125;</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_login<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data_login<span class="token punctuation">)</span><span class="token comment">#在创建的session下用post发起登录请求，放入参数：请求登录的网址、请求头和登录参数。</span>url_comment <span class="token operator">=</span> <span class="token string">'https://xiaoke.kaikeba.com/example/wordpress/wp-comments-post.php'</span><span class="token comment">#把我们想要评论的文章网址赋值给url_comment。</span>data_comment <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'comment'</span><span class="token punctuation">:</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入你想要发表的评论：'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'submit'</span><span class="token punctuation">:</span> <span class="token string">'发表评论'</span><span class="token punctuation">,</span>    <span class="token string">'comment_post_ID'</span><span class="token punctuation">:</span> <span class="token string">'35'</span><span class="token punctuation">,</span>    <span class="token string">'comment_parent'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">&#125;</span><span class="token comment">#把有关评论的参数封装成字典。</span>comment <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url_comment<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data_comment<span class="token punctuation">)</span><span class="token comment">#在创建的session下用post发起评论请求，放入参数：文章网址，请求头和评论参数，并赋值给comment。</span><span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span></code></pre><h4 id="cookie的存储"><a href="#cookie的存储" class="headerlink" title="cookie的存储"></a>cookie的存储</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jsonsession <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>cookie_dict <span class="token operator">=</span> requests<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>dict_from_cookiejar<span class="token punctuation">(</span>session<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token comment">#把cookie转化成字典。</span><span class="token keyword">print</span><span class="token punctuation">(</span>cookie_dict<span class="token punctuation">)</span>cookie_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>cookie_dict<span class="token punctuation">)</span><span class="token comment">#调用json模块的dumps函数，把cookie从字典再转成字符串。</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token comment">#创建名为cookie.txt的文件，以写入模式写入内容。</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>cookie_str<span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>json: json.dumps—将python对象（字典…）编码为json字符串 json.loads—将编码的json字符串解码为python对象</p><p>requests.utils.dict_from_cookiejar—从cookiejar返回 键&#x2F;值 字典。<br>requests.utils.cookiejar_from_dict—-从字典返回cookiejar.</p><h4 id="cookie的读取"><a href="#cookie的读取" class="headerlink" title="cookie的读取"></a>cookie的读取</h4><pre class="language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>cookie_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>cookie <span class="token operator">=</span> requests<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>cookiejar_from_dict<span class="token punctuation">(</span>cookie_dict<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>cookie_dict<span class="token punctuation">)</span>session<span class="token punctuation">.</span>cookies<span class="token operator">=</span>cookief<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="终极武器——–selenuim"><a href="#终极武器——–selenuim" class="headerlink" title="终极武器——–selenuim"></a>终极武器——–selenuim</h3><p>selenium可以通过控制浏览器，做出自动打开、输入、点击等操作，就像是有一个真正的用户在操作一样</p><p>pip install selenium</p><p>安装浏览器驱动 这里使用chrome :</p><p>驱动网址： <a href="http://chromedriver.storage.googleapis.com/index.html">http://chromedriver.storage.googleapis.com/index.html</a></p><p>浏览器地址栏输入 chrome:&#x2F;&#x2F;version查看浏览器版本等信息</p><p>根据版本下载合适的驱动，解压后得到Chromedriver.exe，放在python根目录</p><h4 id="本地Chrome浏览器设置方法"><a href="#本地Chrome浏览器设置方法" class="headerlink" title="本地Chrome浏览器设置方法"></a>本地Chrome浏览器设置方法</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">### selenium示例</span><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">import</span> timedriver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">##启动chromedriver，打开浏览器</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/X-Man/'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>teacher <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'teacher'</span><span class="token punctuation">)</span>teacher<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'开课吧'</span><span class="token punctuation">)</span>assistant <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span><span class="token string">'assist'</span><span class="token punctuation">)</span>assistant<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'全都喜欢'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>button <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>button<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python">driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 设置引擎为Chrome，从本地打开一个Chrome浏览器</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/X-Man/'</span><span class="token punctuation">)</span> <span class="token comment"># 访问页面</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 等待3秒</span>label <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span> <span class="token comment"># 解析网页并提取第一个&lt;label>标签</span><span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment"># 打印label的文本</span>driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭浏览器</span></code></pre><h4 id="Selenium用来提取数据的常用方法："><a href="#Selenium用来提取数据的常用方法：" class="headerlink" title="Selenium用来提取数据的常用方法："></a>Selenium用来提取数据的常用方法：</h4><p>find_element(s)_by_id —————————————-通过元素id进行选择——element加s表示取多个类似于BeautifulSoup中的find和find_all</p><p>find_element(s)_by_class_name ——————————–通过元素class进行选择</p><p>find_element(s)_by_tag_name ———————————-通过元素的标签名（tag）进行选择</p><p>find_element(s)_by_name ————————————–通过元素的name进行选择</p><p>find_element(s)_by_partial_link_text ————————-通过链接的部分文本来获取超链接</p><p>如 <code>&lt;a href=&quot;spidermen.html&quot;&gt;你好，X战警 &lt;/a&gt; </code> # 可以使用find_element_by_link_text(‘你好，X战警’) 提取出超链接，</p><p>find_element(s)_by_link_text ———————————通过链接的文本来获取超链接</p><pre class="language-python" data-language="python"><code class="language-python">driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 设置引擎为Chrome，从本地打开一个Chrome浏览器</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://xiaoke.kaikeba.com/example/X-Man/'</span><span class="token punctuation">)</span> <span class="token comment"># 访问页面</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 等待两秒</span>label <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span><span class="token string">'form-teacher'</span><span class="token punctuation">)</span> <span class="token comment"># 根据类名找到元素</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 打印label的数据类型</span><span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 获取type这个属性的值</span>driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭浏览器</span></code></pre><p>利用selenium爬取周杰伦《说好不哭》歌曲评论 <a href="https://y.qq.com/n/yqq/song/001qvvgF38HVc4.html">https://y.qq.com/n/yqq/song/001qvvgF38HVc4.html</a></p><p>selenium可以爬取网页渲染完成之后的源代码</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoupdriver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">##启动chromedriver，打开浏览器</span>driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://y.qq.com/n/yqq/song/001qvvgF38HVc4.html'</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>html <span class="token operator">=</span> driver<span class="token punctuation">.</span>page_source<span class="token comment"># print(html)</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span>comment <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">"comment__text"</span><span class="token punctuation">)</span><span class="token comment">#打印爬取下来的评论信息</span><span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> comment<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>driver<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>小tip：当爬取的网页出现乱码时，考虑可能是编码的问题，在查看网页源代码，搜索charset查看编码格式，然后使用response.encoding&#x3D;’编码’，设置一下编码就可以了</p><h3 id="gevent异步爬虫"><a href="#gevent异步爬虫" class="headerlink" title="gevent异步爬虫"></a>gevent异步爬虫</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gevent <span class="token keyword">import</span> monkey<span class="token comment">#从gevent库里导入monkey模块。</span>monkey<span class="token punctuation">.</span>patch_all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#monkey.patch_all()能把程序变成协作式运行，就是可以帮助程序实现异步。</span><span class="token keyword">import</span> gevent<span class="token keyword">import</span> time<span class="token keyword">import</span> requests<span class="token comment">#导入gevent、time、requests。</span><span class="token triple-quoted-string string">'''    同步爬虫执行爬取任务时按顺序进行，会产生很多等待时间，    异步爬虫多任务同时执行（这里的同时执行代指--当一个爬虫进入等待时间，另一个爬虫进入cpu）,    所以在爬取大量数据时，异步爬虫所需要的时间比同步爬虫少。'''</span>start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#记录程序开始时间。</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"异步爬虫"</span><span class="token punctuation">)</span>url_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span><span class="token string">'https://www.sina.com.cn/'</span><span class="token punctuation">,</span><span class="token string">'http://www.sohu.com/'</span><span class="token punctuation">,</span><span class="token string">'https://www.qq.com/'</span><span class="token punctuation">,</span><span class="token string">'https://www.163.com/'</span><span class="token punctuation">,</span><span class="token string">'http://www.iqiyi.com/'</span><span class="token punctuation">,</span><span class="token string">'https://www.tmall.com/'</span><span class="token punctuation">,</span><span class="token string">'http://www.ifeng.com/'</span><span class="token punctuation">]</span><span class="token comment">#把8个网站封装成列表。</span><span class="token keyword">def</span> <span class="token function">crawler</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#定义一个crawler()函数。</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token comment">#用requests.get()函数爬取网站。</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">,</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>    <span class="token comment">#打印网址、请求运行时间、状态码。</span>tasks_list <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token comment">#创建空的任务列表。</span><span class="token keyword">for</span> url <span class="token keyword">in</span> url_list<span class="token punctuation">:</span><span class="token comment">#遍历url_list。</span>    task <span class="token operator">=</span> gevent<span class="token punctuation">.</span>spawn<span class="token punctuation">(</span>crawler<span class="token punctuation">,</span>url<span class="token punctuation">)</span>    <span class="token comment">#用gevent.spawn()函数创建任务。</span>    tasks_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>task<span class="token punctuation">)</span>    <span class="token comment">#往任务列表添加任务。</span>gevent<span class="token punctuation">.</span>joinall<span class="token punctuation">(</span>tasks_list<span class="token punctuation">)</span><span class="token comment">#执行任务列表里的所有任务，就是让爬虫开始爬取网站。</span>end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#记录程序结束时间。</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'异步爬虫时间：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>end<span class="token operator">-</span>start<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token comment">#打印程序最终所需时间。</span><span class="token comment">### 同步爬虫</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"同步爬虫"</span><span class="token punctuation">)</span><span class="token comment">#导入requests和time</span>start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#记录程序开始时间</span><span class="token keyword">for</span> url <span class="token keyword">in</span> url_list<span class="token punctuation">:</span><span class="token comment">#遍历url_list</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>time_taken <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'同步爬虫时间：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>time_taken<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></code></pre><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><h4 id="天气查询"><a href="#天气查询" class="headerlink" title="天气查询"></a>天气查询</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> os<span class="token keyword">import</span> re   <span class="token comment">### 正则表达式</span><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token comment"># url = 'http://www.weather.com.cn/'</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---城市天气查询系统---"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"（目前只支持查询县（区）级以上城市天气）"</span><span class="token punctuation">)</span>city <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入查询地址："</span><span class="token punctuation">)</span>city<span class="token operator">=</span>city<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'省'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'市'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'县'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'区'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">'http://toy1.weather.com.cn/search?cityname='</span><span class="token operator">+</span>city<span class="token operator">+</span><span class="token string">'&amp;callback=success_jsonpCallback&amp;_=1635127411542'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36'</span><span class="token punctuation">&#125;</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>res<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token comment"># print(type(res.text))</span><span class="token comment"># print(res.text)</span>nums <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"\d+\.?\d*"</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment"># 正则表达式</span>city_num <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment"># print(city_num)</span>city_url <span class="token operator">=</span> <span class="token string">'http://www.weather.com.cn/weather/'</span><span class="token operator">+</span>city_num<span class="token operator">+</span><span class="token string">'.shtml'</span>city_html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>city_url<span class="token punctuation">)</span>city_html<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>city_html<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>weather_htmls <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'t clearfix'</span><span class="token punctuation">)</span>weathea_lis <span class="token operator">=</span> weather_htmls<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>city_name <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'crumbs fl'</span><span class="token punctuation">)</span>city_name <span class="token operator">=</span> <span class="token punctuation">(</span>city_name<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment">### 字符串过滤，过滤空格和换行符</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'\n地区：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>city_name<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>  <span class="token comment"># 城市名字</span><span class="token keyword">for</span> weather_html <span class="token keyword">in</span> weathea_lis<span class="token punctuation">:</span>    data_time <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 日期</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'时间：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_time<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    data_weather <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'wea'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 天气</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'天气：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_weather<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    data_tem <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'tem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 温度</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'温度：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_tem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token format-spec">8]</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span></code></pre><h4 id="定时爬取中国气象网的数据，使用邮件发送到邮箱。"><a href="#定时爬取中国气象网的数据，使用邮件发送到邮箱。" class="headerlink" title="定时爬取中国气象网的数据，使用邮件发送到邮箱。"></a>定时爬取中国气象网的数据，使用邮件发送到邮箱。</h4><p>这里发送邮件会用到几个python库—–smtplib和email(这两个是python内置库，不需要使用pip安装)</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> smtplib<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText<span class="token keyword">import</span> schedule <span class="token comment">## 定时操作模块</span><span class="token keyword">def</span> <span class="token function">weather_send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment">## 天气的爬取，这里我们从中国气象网爬取数据</span>    <span class="token comment">## 网址： http://www.weather.com.cn/</span>    <span class="token keyword">global</span> city_name<span class="token punctuation">,</span> data_time<span class="token punctuation">,</span> data_weather<span class="token punctuation">,</span> data_tem  <span class="token comment">## 定义全局变量</span>    url <span class="token operator">=</span> <span class="token string">"http://www.weather.com.cn/weather/101260103.shtml"</span>  <span class="token comment">## 爬取的是花溪区的数据</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    res<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>    weather_htmls <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'t clearfix'</span><span class="token punctuation">)</span>    weathea_lis <span class="token operator">=</span> weather_htmls<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> weather_html <span class="token keyword">in</span> weathea_lis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        city_name <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'crumbs fl'</span><span class="token punctuation">)</span>        city_name <span class="token operator">=</span> <span class="token punctuation">(</span>city_name<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment">### 字符串过滤，过滤空格和换行符</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'地区：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>city_name<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>  <span class="token comment"># 城市名字</span>        data_time <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 日期</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'时间：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_time<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        data_weather <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'wea'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 天气</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'天气：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_weather<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        data_tem <span class="token operator">=</span> weather_html<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'tem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text  <span class="token comment"># 温度</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'温度：</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_tem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token format-spec">8]</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    emailhost <span class="token operator">=</span> <span class="token string">'smtp.qq.com'</span>    email <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## 实例化smtp（）对象</span>    email<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>emailhost<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>  <span class="token comment">## 连接smtp服务器</span>    my_qqemail <span class="token operator">=</span> <span class="token string">'这里是发件邮箱'</span>    my_qqemail_pwd <span class="token operator">=</span> <span class="token string">'邮箱密码'</span> <span class="token comment">##这里的密码是在邮箱设置里面开启smtp服务的密码，并非邮箱密码</span>    email<span class="token punctuation">.</span>login<span class="token punctuation">(</span>my_qqemail<span class="token punctuation">,</span> my_qqemail_pwd<span class="token punctuation">)</span>  <span class="token comment"># 登录邮件客户端</span>    <span class="token comment"># recipient = '要发送的邮箱'</span>    recipient <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入收件人邮箱地址："</span><span class="token punctuation">)</span>    content <span class="token operator">=</span> <span class="token string">'你好，这里是燚向你推送的明天天气：'</span> <span class="token operator">+</span>\              <span class="token string">'\n'</span> <span class="token operator">+</span><span class="token string">'地区：'</span><span class="token operator">+</span>city_name <span class="token operator">+</span> <span class="token string">'\n'</span>\              <span class="token operator">+</span><span class="token string">'时间：'</span><span class="token operator">+</span> data_time <span class="token operator">+</span> <span class="token string">'\n'</span> \              <span class="token operator">+</span> <span class="token string">'天气：'</span> <span class="token operator">+</span> data_weather <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">+</span> \              <span class="token string">'温度：'</span> <span class="token operator">+</span> data_tem<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">+</span> \              <span class="token string">'天气冷了，记得多穿衣服，注意保暖！！'</span>    message <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>    subject <span class="token operator">=</span> <span class="token string">"燚 —— 天气预报(测试版)"</span>    message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        email<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>my_qqemail<span class="token punctuation">,</span>recipient<span class="token punctuation">,</span>message<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"发送成功"</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> EnvironmentError <span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"发送失败"</span><span class="token punctuation">)</span>    email<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># if __name__ == '__main__':</span><span class="token comment">#     weather_send()</span><span class="token comment"># 定时发送</span><span class="token comment"># schedule.every().day.at("20:56").do(weather_send)   # 每天定时发送</span>schedule<span class="token punctuation">.</span>every<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span>seconds<span class="token punctuation">.</span>do<span class="token punctuation">(</span>weather_send<span class="token punctuation">)</span>   <span class="token comment">## 每30秒发送</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    schedule<span class="token punctuation">.</span>run_pending<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre><h4 id="表情包爬取"><a href="#表情包爬取" class="headerlink" title="表情包爬取"></a>表情包爬取</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token comment"># 爬取表情包 , 存放到tworequest_tupian文件夹 请先在本地创建一个空文件夹</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">"http://www.bbsnet.com/egao"</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    html <span class="token operator">=</span> res<span class="token punctuation">.</span>text             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">"html.parser"</span><span class="token punctuation">)</span>    imgs <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">"zoom"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgs<span class="token punctuation">:</span>        picture <span class="token operator">=</span> img<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span>        pics <span class="token operator">=</span> picture<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'下载来自</span><span class="token interpolation"><span class="token punctuation">&#123;</span>pics<span class="token punctuation">&#125;</span></span><span class="token string">的图片'</span></span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">"-------------------"</span><span class="token punctuation">)</span>        pic <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pics<span class="token punctuation">)</span>        x <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        imgname <span class="token operator">=</span> <span class="token string">"tworequest_tupian/image_egao"</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">".gif"</span>        p <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>imgname<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>        p<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pic<span class="token punctuation">.</span>content<span class="token punctuation">)</span>        p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"下载成功"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取完成"</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> requests </tag>
            
            <tag> BeautifulSoup </tag>
            
            <tag> cookie </tag>
            
            <tag> session </tag>
            
            <tag> selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo的博客搭建记录</title>
      <link href="/2022/05/14/myFirstBlog/"/>
      <url>/2022/05/14/myFirstBlog/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文将使用基于node.js的一个快速、简介且高效的博客框架————hexo，完成一个博客网站的搭建，由于hexo是建立在node之上，建议先在本地完成node.js环境的配置。</p><h5 id="相关链接："><a href="#相关链接：" class="headerlink" title="相关链接："></a>相关链接：</h5><p>hexo官方文档：<a href="https://hexo.bootcss.com/docs/">https://hexo.bootcss.com/docs/</a></p><p>hexo主题配置： <a href="https://easyhexo.com/2-Theme-use-and-config/">https://easyhexo.com/2-Theme-use-and-config/</a></p><h2 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建<br/></h2><h3 id="一，项目初始化"><a href="#一，项目初始化" class="headerlink" title="一，项目初始化"></a>一，项目初始化</h3><p>1、使用npm下载hexo</p><pre class="language-none"><code class="language-none">npm install -g hexo-cli</code></pre><p>2、创建一个项目文件夹(目录随意)，名称随意，我这里以hexo为例</p><pre class="language-none"><code class="language-none">mkdir hexo &#x2F;&#x2F; 创建一个名为hexo的文件夹cd hexo &#x2F;&#x2F;进入hexo目录下hexo init &#x2F;&#x2F;初始化，等待下载完成</code></pre><p><img src="/2022/05/14/myFirstBlog/image-20220515140323539.png" alt="image-20220515140323539"></p><p>当看到这样的字样则表示项目初始化成功！！！</p><p>3、将项目运行起来，使用控制台进入当前目录，win+r，输入cmd，然后cd 到当前目录即可，不过在windows下需要注意的是，如果要切换到其他盘，如D ,E盘，则需要先输入d: 或 e:  。</p><pre class="language-none"><code class="language-none">npm install &#x2F;&#x2F;首先导入相关的依赖hexo g  hexo s</code></pre><p>此时可以看到<img src="/2022/05/14/myFirstBlog/hexo-s.png" alt="hexo-s"></p><p>在浏览器输入localhost:4000即可打开博客页面，如下图所示</p><p><img src="/2022/05/14/myFirstBlog/image.png" alt="hexo-s"></p><p>这样，博客搭建的第一步就完成了，顺便介绍一下hexo常用的几个命令</p><ul><li>hexo clean清空当前编译好的静态文件以及缓存文件，可以理解为将博客网页清空</li><li>hexo generate  生成静态文件，也就是生成博客页面 ，可以简写为 hexo g</li><li>hexo server       从本地服务器打开博客，可以简写为hexo s</li><li>hexo deploy      将博客进行部署，这个暂时不进行描述</li><li>hexo new page pagename 新建一个页面</li><li>hexo new blogname    新建一篇博客，也就是创建一个markdown文件，存放在项目根目录下的source&#x2F;_posts下</li></ul><p>然后看一下项目的基本目录结构</p><pre class="language-none"><code class="language-none">node_module   --项目依赖文件夹public        --生成的静态网页目录themes        --主题文件夹，下载的主题放到这里面source        --与我们接触最多的一个文件夹，里面放着各种页面，文章和图片-_posts   --写的博客就放在这里面_config.yml   --项目配置文件</code></pre><br/><h3 id="二，博客界面美化"><a href="#二，博客界面美化" class="headerlink" title="二，博客界面美化"></a>二，博客界面美化</h3><p>hexo官网给我们提供了很多免费的主题，<a href='https://hexo.bootcss.com/themes/'>传送门</a>，可以在这里寻找自己喜欢的主题，用git克隆到themes目录后，在_config.yml配置文件进行切换，如图</p><p><img src="/2022/05/14/myFirstBlog/themes.png" alt="themes"></p><p>这里我使用的是matery主题，是把他克隆到项目根目录下的themes主题目录下</p><pre class="language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;blinkfox&#x2F;hexo-theme-matery.git themes&#x2F;hexo-theme-matery</code></pre><p>然后根据上图修改配置文件即可，修改完成后记得重新生成静态文件hexo g，然后重新运行hexo s</p><p>查看效果</p><p><img src="/2022/05/14/myFirstBlog/myblog.png" alt="myblog"></p><p>关于博客主题的相关配置，在themes下的hexo-theme-matery下有一个_config.yml的配置文件，里面都有注释，可以进行相关功能的添加</p><p>关于标签、分类、关于等界面点击后没有页面的情况，我们查看hexo-theme-matery文档</p><p><a href="https://easyhexo.com/2-Theme-use-and-config/2-14-hexo-theme-matery/">https://easyhexo.com/2-Theme-use-and-config/2-14-hexo-theme-matery/</a></p><p><img src="/2022/05/14/myFirstBlog/image-20220515224748462.png" alt="image-20220515224748462"></p><p>根据官方文档进行相关界面的配置即可，这里以categories为例</p><pre class="language-none"><code class="language-none">hexo new page &quot;categories&quot;</code></pre><p>然后在source目录下找到categories&#x2F;index.md，修改如下，即可，</p><pre class="language-none"><code class="language-none">---title: categoriesdate: 2018-09-30 17:25:30  &#x2F;&#x2F;时间可不做修改type: &quot;categories&quot;layout: &quot;categories&quot;---</code></pre><p>其他页面也是一样的方法，配置完成后重新打包静态文件，hexo g然后运行就可以了</p><h2 id="加载速度优化"><a href="#加载速度优化" class="headerlink" title="加载速度优化"></a>加载速度优化</h2><p>在使用过程中发现，有时候会出现加载缓慢的问题，我们打开控制台，点击网络，这时候发现一个名叫typed.js的文件请求失败了，怀疑是这个文件一直请求不成功，导致网页一直阻塞在加载状态。</p><p><img src="/2022/05/14/myFirstBlog/image-20220517171949910.png" alt="image-20220517171949910"></p><p>这是一个用来实现首页打字效果的js插件，我们在主题目录下（也就是hexo-theme-matery文件夹下）的layout\_partial下找到一个bg-cover-content.ejs的文件，打开可看到这里是使用的cdn引入</p><p><img src="/2022/05/14/myFirstBlog/image-20220517172408357.png" alt="image-20220517172408357"></p><p>我们可以直接把这个文件下载到本地，这样就不用每次都需要从网上去下载资源，，尤其在网络比较慢的情况下，会让博客的加载一直处于阻塞状态。</p><p>找不到下载地址的小伙伴可以使用我这个地址</p><pre class="language-none"><code class="language-none">https:&#x2F;&#x2F;zhaojiuyi.github.io&#x2F;medias&#x2F;js&#x2F;typed.min.js</code></pre><p>打开后是这样的一个网页</p><p><img src="/2022/05/14/myFirstBlog/image-20220518115528520.png" alt="image-20220518115528520"></p><p>全部选中后在主题目录hexo-theme-matery下的source\js下创建一个type-min.js文件，将内容粘贴进去，然后保存，最后在hexo-theme-matery\layout\_partial下的bg-cover-content.ejs下导入js文件</p><pre class="language-none"><code class="language-none">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;js&#x2F;typed.min.js&quot;&gt;&lt;&#x2F;script&gt;</code></pre><p><img src="/2022/05/14/myFirstBlog/image-20220518120012775.png" alt="image-20220518120012775"></p><p>图片中删除的部分路径可能不太一样，只用看最后都是type.js或者type.min.js就可以了</p><p>现在重新打包静态文件，可以看到博客启动速度变快了。</p><h2 id="来个开箱即用"><a href="#来个开箱即用" class="headerlink" title="来个开箱即用"></a>来个开箱即用</h2><p>使用如下命令，直接克隆博主搭建好的博客到本地</p><pre class="language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;zhaojiuyi&#x2F;hexo-matery.git</code></pre><p>使用hexo g生成静态文件，然后hexo s运行后在浏览器输入localhost:4000打开，功能虽然不多，也还能满足基本需求。关于部署的问题网上教程很多，暂时先不做叙述了。</p><pre class="language-none"><code class="language-none">npm installhexo cleanhexo ghexo s</code></pre><p>最后推荐几篇博客</p><p>hexo+github博客搭建和部署，个人认为十分详细：,<a href="https://blog.csdn.net/qq_58608526/article/details/124652412">https://blog.csdn.net/qq_58608526/article/details/124652412</a></p><p>页面加载动画：<a href="https://blog.csdn.net/weixin_43662760/article/details/122311217">https://blog.csdn.net/weixin_43662760/article/details/122311217</a></p><p>网页昼夜切换的效果：<a href="https://dreamruins.gitee.io/tutorials/1121281946.html#vcomments">https://dreamruins.gitee.io/tutorials/1121281946.html#vcomments</a></p>]]></content>
      
      
      <categories>
          
          <category> 博客搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node </tag>
            
            <tag> npm </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/05/10/hello-world/"/>
      <url>/2022/05/10/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 说明 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
